env: "prod"  # "prod" or "paper"

kis:
  env: "prod"
  base_url_prod: "https://openapi.koreainvestment.com:9443"
  base_url_paper: "https://openapivts.koreainvestment.com:29443"
  ws_url_prod: "ws://ops.koreainvestment.com:21000"
  ws_url_paper: "ws://ops.koreainvestment.com:31000"
  app_key: "${KIS_APP_KEY}"
  app_secret: "${KIS_APP_SECRET}"
  use_hashkey: true
  hashkey_cache_ttl_sec: 30
  account_no: "${KIS_ACCOUNT_NO}"  # 예: 00000000-01
  custtype: "P"
  token_cache_path: ".cache/kis_token.json"
  rate_limit_sleep_sec: 0.25
  timeout_connect_sec: 5
  timeout_read_sec: 20
  max_retries: 8
  backoff_base_sec: 2
  backoff_cap_sec: 60
  backoff_jitter_sec: 0.5
  consecutive_error_cooldown_after: 10
  consecutive_error_cooldown_sec: 180
  auth_forbidden_cooldown_sec: 600
  session_reset_every: 3
  accuracy_rate_limit_sleep_sec: 0.25
  accuracy_item_sleep_sec: 0.1

logging:
  level: "INFO"
  path: "logs/bnf_trader.log"

trading:
  ord_dvsn: "01"         # 01=시장가, 00=지정가
  order_value: 50000     # 포지션당 목표 금액(원, 잔고 없을 때 기준)

telegram:
  enabled: false
  token: "${TG_BOT_TOKEN}"
  chat_id: "${TG_CHAT_ID}"

discord:
  enabled: true
  webhook: "${DISCORD_WEBHOOK_URL}"

backtest:
  initial_cash: 10000000
  max_positions: 10

# DB -> CSV export
export_csv:
  enabled: true
  out_dir: "data/csv"
  mode: "overwrite"      # "overwrite" | "timestamped" | "append"
  tables: []          # empty = all tables

monitor:
  enabled: false
  scan_interval_sec: 60
  rest_batch_size: 30
  rest_max_retries: 5
  max_ws_subs: 41
  ws_subscribe_interval_sec: 0.2  # 구독/해제 메시지 간격(공지 권고에 맞춤)
  subscribe_cooldown_sec: 180
  alert_cooldown_sec: 600
  universe_paths:
    - "data/universe_kospi100.csv"
    - "data/universe_kosdaq150.csv"
  state_path: "data/monitor_state.json"
  ws_tr_id: "H0STCNT0"
  signal:
    type: "disparity_threshold"
    disparity_threshold: -0.08
    use_intraday: true

watchdog:
  enabled: true
  interval_sec: 1800
  accuracy_cooldown_sec: 21600
  accuracy_min_missing: 1
  accuracy_item_sleep_sec: 0.5
  accuracy_rate_sleep_sec: 0.5
  accuracy_notify_every: 20
  accuracy_progress_file: "data/accuracy_progress_watchdog.json"
  accuracy_codes_file: "data/csv/accuracy_missing_codes.csv"
  accuracy_lock_file: "data/accuracy_loader.lock"
  lock_file: "data/watchdog.lock"

# 예시 전략 파라미터(실제 운영 시 strategy.yaml로 분리 가능)
strategy:
  liquidity_rank: 300
  min_amount: 50000000000  # 500억
  disparity_buy_kospi: -0.05
  disparity_buy_kosdaq: -0.10
  disparity_sell: -0.01
  stop_loss: -0.05
  max_holding_days: 3

# Discord on by default
